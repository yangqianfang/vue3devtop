var o=(a,l,t)=>new Promise((m,p)=>{var _=i=>{try{s(t.next(i))}catch(h){p(h)}},g=i=>{try{s(t.throw(i))}catch(h){p(h)}},s=i=>i.done?m(i.value):Promise.resolve(i.value).then(_,g);s((t=t.apply(a,l)).next())});import{T as V,B as N,P}from"./TableAction.ac78c7a4.js";import{g as M,a as I,p as L,b as U,c as Y,d as j}from"./console.d8d50ee9.js";import z from"./CurTag.b05b6c6a.js";import{t as k,v as H,x as O,_ as q,d as G,f as K,y as J,r as b,z as Q,u as W,b as X,o as Z,h as ee,i as E,a as c,w as r,j as y,l as A,N as te,q as ue,A as ae}from"./index.43e8d9d2.js";import{h as ne,U as se}from"./moment.2202a2c5.js";import"./useDesignSetting.514ed8ee.js";import"./index.esm.2f1f496e.js";const oe=[{title:"\u670D\u52A1\u540D\u79F0",key:"name",width:120},{title:"Git\u540D\u79F0",key:"project",width:80,render(a){return a.project}},{title:"\u9879\u76EE\u5206\u7EC4",key:"groups",width:80},{title:"\u5347\u7EA7\u65F6\u95F4	",key:"latest_time",width:160,render(a){return ne.utc(a.latest_time).format("YYYY-MM-DD HH:MM:SS")}},{title:"\u5F53\u524D\u7248\u672C	",key:"version",width:120,render(a){return k(z,{title:a.version})}},{title:"\u53EF\u5347\u7EA7\u7248\u672C	",key:"list",width:150,render(a){return k(O,{options:a.list,align:"left",placeholder:a.version,style:"width:120px","default-value":a.selectVersion,loading:a.loading,"on-update:value"(l){a.selectVersion=l},onClick:()=>o(this,null,function*(){a.loading=!0;const l=yield M({id:a.id});a.list=H(l),a.loading=!1})})}}];const ie={class:"console"},le={class:"mt-4"},ce={class:"list-title"},re=A(" \u670D\u52A1\u5217\u8868 "),de=A(" \u65B0\u5EFA "),pe=G({name:"console",setup(a){const l=K(),t=window.$Loading,m=J(),p=b([]),_=b();function g(e){return e.forEach(u=>{u.loading=!1,u.list=[],u.selectVersion=u.version}),e}Q(()=>o(this,null,function*(){F()}));const s=W(),i=b(),h=X({width:"320",title:"\u64CD\u4F5C",key:"action",fixed:!1,render(e){return k(V,{style:"button",actions:[{label:"\u53D1\u5E03",type:"success",icon:"ic:outline-delete-outline",onClick:()=>{B(e)}},{label:"\u5B8C\u6210",type:"warning",onClick:()=>{x(e)}},{label:"\u56DE\u6EDA",type:"error",onClick:()=>{$(e)}},{label:"\u7F16\u8F91",type:"error",ifShow:()=>_.value===1,onClick:()=>{C(e)}},{label:"\u5220\u9664",ifShow:()=>_.value===1,type:"error",onClick:()=>{S(e)}}]})}}),F=()=>o(this,null,function*(){t.value.show();let e=yield I();p.value=g(e.apps),_.value=e.adminId,t.value.hide()});function w(e){console.log(e)}function f(){F()}const B=e=>o(this,null,function*(){let{id:u,selectVersion:n,version:v,name:d}=e;if(!n){s.warning("\u7248\u672C\u53F7\u4E0D\u6B63\u786E\uFF01");return}if(n===v){let D=`\u670D\u52A1[${d}]\u7248\u672C\u53F7${n}\u5DF2\u7ECF\u4E0A\u7EBF\uFF01`;s.warning(D);return}try{t.value.show(),yield L({id:u,name:d,version:n}),s.success(`\u670D\u52A1[${d}]\u7248\u672C\u53F7${n} \u53D1\u5E03\u6210\u529F`),t.value.hide(),f()}catch(D){t.value.hide()}}),x=e=>o(this,null,function*(){let{id:u,version:n,name:v}=e;try{t.value.show(),yield U({id:u,version:n}),s.success(`\u670D\u52A1[${v}]\u5B8C\u6210\u5347\u7EA7!`),t.value.hide(),f()}catch(d){t.value.hide()}});function T(e){return o(this,null,function*(){try{let{id:u,name:n}=e;t.value.show(),yield Y({id:u}),s.success(`\u670D\u52A1[${n}]\u56DE\u6EDA\u6210\u529F!`),t.value.hide(),f()}catch(u){t.value.hide()}})}const $=e=>o(this,null,function*(){let{name:u}=e;m.info({title:"\u63D0\u793A",content:`\u786E\u5B9A\u8981\u56DE\u6EDA[${u}]\u5417\uFF1F`,positiveText:"\u786E\u5B9A",negativeText:"\u53D6\u6D88",onPositiveClick:()=>{T(e)},onNegativeClick:()=>{}})});function R(e){return o(this,null,function*(){try{t.value.show(),yield j(e),s.success(`\u670D\u52A1[${e.name}]\u5220\u9664\u6210\u529F!`),t.value.hide(),f()}catch(u){t.value.hide()}})}const S=e=>o(this,null,function*(){let{id:u,name:n}=e;m.info({title:"\u63D0\u793A",content:`\u786E\u5B9A\u8981\u5220\u9664\u670D\u52A1[${n}]\u5417\uFF1F`,positiveText:"\u786E\u5B9A",negativeText:"\u53D6\u6D88",onPositiveClick:()=>{R({id:u,name:n})},onNegativeClick:()=>{}})}),C=e=>{let u=e.id?{id:e.id}:{};l.push({name:"addapp",params:u})};return(e,u)=>{const n=te,v=ue,d=ae;return Z(),ee("div",ie,[E("div",le,[c(d,{bordered:!1,class:"proCard"},{default:r(()=>[c(y(N),{columns:y(oe),dataSource:p.value,"row-key":D=>D.id,pagination:!1,ref_key:"actionRef",ref:i,reloadBt:F,actionColumn:h,"onUpdate:checkedRowKeys":w,"scroll-x":1090},{tableTitle:r(()=>[E("div",ce,[c(n,{size:"18"},{default:r(()=>[c(y(se))]),_:1}),re])]),toolbar:r(()=>[c(v,{type:"primary",size:"small",onClick:C},{icon:r(()=>[c(n,null,{default:r(()=>[c(y(P))]),_:1})]),default:r(()=>[de]),_:1})]),_:1},8,["columns","dataSource","row-key","actionColumn"])]),_:1})])])}}});var Fe=q(pe,[["__scopeId","data-v-15f56810"]]);export{Fe as default};
